# 通过外部镜像文件创建私有镜像<a name="bms_01_0027"></a>

## 操作场景<a name="section9787459153815"></a>

您可以通过外部镜像文件创建私有镜像并在云平台上完成注册。创建私有镜像的过程如[图1](#fig38131647453)所示。

**图 1**  创建过程<a name="fig38131647453"></a>  
![](figures/创建过程.png "创建过程")

步骤说明如下：

1.  准备镜像文件，请参考《裸金属服务器私有镜像制作指南》了解详细步骤。
2.  上传外部镜像文件到OBS个人桶中，请参考[上传外部镜像文件](#section175082275342)。
3.  通过管理控制台选择上传的镜像文件，并将镜像文件注册为私有镜像，请参考[注册私有镜像](#section17202836566)。

## 上传外部镜像文件<a name="section175082275342"></a>

当前云平台支持导入vhd、vmdk、qcow2、raw、vhdx、qcow、vdi、qed、zvhd或zvhd2等格式镜像文件创建私有镜像。

请使用OBS Browser+工具上传外部镜像文件，详细操作请参见《[OBS Browser+最佳实践](https://support.huaweicloud.com/browsertg-obs/obs_03_1006.html)》。

上传外部镜像文件到OBS桶时，OBS桶和镜像文件的存储类别必须为标准存储。

请参考如下页面下载OBS Browser+工具：

[https://support.huaweicloud.com/browsertg-obs/obs\_03\_1003.html](https://support.huaweicloud.com/browsertg-obs/obs_03_1003.html)

## 注册私有镜像<a name="section17202836566"></a>

1.  登录管理控制台。
2.  选择“计算 \> 镜像服务”。

    进入镜像服务页面。

3.  单击右上角的“创建私有镜像”，进入创建私有镜像页面。
4.  根据界面要求填写如下信息：

    **镜像类型和来源**

    -   创建方式：选择“系统盘镜像”。
    -   选择镜像源：选择“镜像文件”，使用外部镜像文件作为源注册私有镜像。

        在桶列表中选择保存镜像文件的桶，再选择对应的镜像文件。

    **配置信息**

    -   镜像用途：选择“BMS系统盘镜像”。

        请确保已参考《裸金属服务器私有镜像制作指南》完成镜像文件的初始化配置。

    -   操作系统：该配置项可选，选择镜像文件对应的操作系统。

        为保证镜像的正常创建和使用，请确保选择的操作系统与镜像文件的操作系统类型一致。

    -   系统盘：设置系统盘容量。该值建议为镜像文件的系统盘大小增加2G。
    -   名称：输入镜像名称。只能由字母、数字、空格和特殊字符“-”、“\_”、“.”组成，且首尾字符都不能为空格。
    -   企业项目：从下拉列表中选择所在的企业项目。该参数针对企业用户使用，只有开通了企业项目的客户，或者权限为企业主帐号的客户才可见。如需使用该功能，请联系您的客户经理申请开通。
    -   标签：该配置项可选，为镜像设置标签键和标签值，便于识别和管理。
    -   描述：该配置项可选，对镜像进行描述。

5.  单击“立即创建”。

    在“资源详情”页面，确认规格无误后，单击“提交申请”。

6.  返回镜像列表，待私有镜像状态变为“正常”时，表示注册成功。

    >![](public_sys-resources/icon-note.gif) **说明：** 
    >根据镜像文件大小不同，注册私有镜像所使用的时间不同，请耐心等待。


## 后续操作<a name="section87741111715"></a>

私有镜像注册成功后，您可能想[通过私有镜像创建裸金属服务器](通过私有镜像创建裸金属服务器.md)。

如果这个私有镜像用于创建规格为c6.22xlarge.physical的裸金属服务器，您还需要通过API为该私有镜像打上“\_\_support\_c6\_22xl\_physical”标签。操作方法如下：

1.  <a name="zh-cn_topic_0058758453_zh-cn_topic_0085214115_li13762086162643"></a>获取Token，请参考“[认证鉴权](https://support.huaweicloud.com/api-ims/ims_03_0303.html)”。
2.  参考“[更新镜像信息](https://support.huaweicloud.com/api-ims/ims_03_0604.html)”API，为镜像打上“\_\_support\_c6\_22xl\_physical”标签。
    1.  在请求消息头中增加“X-Auth-Token”。

        “X-Auth-Token”的取值为步骤[1](#zh-cn_topic_0058758453_zh-cn_topic_0085214115_li13762086162643)中获取的Token。

    2.  请求的URI格式为：

        PATCH /v2/cloudimages/\{image\_id\}

        请求的body体如下所示。

        ```
        [
            {
                "op": "add",
                "path": "/__support_c6_22xl_physical",
                "value": "true"
            }
        ]
        ```



